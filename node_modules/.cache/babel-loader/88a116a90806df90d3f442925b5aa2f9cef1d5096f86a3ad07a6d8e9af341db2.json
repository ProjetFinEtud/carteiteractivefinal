{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'./Chat.css';// import './animations.css';\nimport Formulaire from'./Formulaire';import Message from'./Message';import{database}from'./base';// Importez la référence à la base de données\nimport{CSSTransition,TransitionGroup}from'react-transition-group';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Chat=_ref=>{let{messageid,pseudo}=_ref;const[messages,setMessages]=useState({});const messagesRef=useRef(null);useEffect(()=>{const messagesRef=database.ref(\"messages\".concat(messageid));messagesRef.on('value',snapshot=>{const data=snapshot.val();if(data){setMessages(data.messages);}});return()=>{messagesRef.off();};},[messageid]);useEffect(()=>{if(messagesRef.current){messagesRef.current.scrollTop=messagesRef.current.scrollHeight;}},[messages]);const addMessage=message=>{const newMessages={...messages};newMessages[\"message-\".concat(Date.now())]=message;database.ref(\"messages\".concat(messageid)).update({messages:newMessages});};const isUser=messagePseudo=>messagePseudo===pseudo;const messageList=Object.keys(messages).map(key=>/*#__PURE__*/ // console.log(messages[key].pseudo =pseudo)\n_jsx(CSSTransition,{timeout:200,classNames:\"fade\",children:/*#__PURE__*/_jsx(Message,{isUser:isUser,message:messages[key].message,pseudo:messages[key].pseudo})},key));return/*#__PURE__*/_jsxs(\"div\",{className:\"box\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"messages\",ref:messagesRef,children:/*#__PURE__*/_jsx(TransitionGroup,{className:\"message\",children:messageList})})}),/*#__PURE__*/_jsx(Formulaire,{length:140,pseudo:pseudo,addMessage:addMessage})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","Formulaire","Message","database","CSSTransition","TransitionGroup","jsx","_jsx","jsxs","_jsxs","Chat","_ref","messageid","pseudo","messages","setMessages","messagesRef","ref","concat","on","snapshot","data","val","off","current","scrollTop","scrollHeight","addMessage","message","newMessages","Date","now","update","isUser","messagePseudo","messageList","Object","keys","map","key","timeout","classNames","children","className","length"],"sources":["C:/Users/abdou/Documents/S9-S10/ProjetFinDetudes/Jalon3/v2/demo - Copie/server/client/src/Components/Messages/Chat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport './Chat.css';\r\n// import './animations.css';\r\nimport Formulaire from './Formulaire';\r\nimport Message from './Message';\r\nimport { database } from './base'; // Importez la référence à la base de données\r\n\r\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\r\n\r\nconst Chat = ({ messageid, pseudo }) => {\r\n  const [messages, setMessages] = useState({});\r\n  const messagesRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const messagesRef = database.ref(`messages${messageid}`);\r\n    messagesRef.on('value', (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        setMessages(data.messages);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      messagesRef.off();\r\n    };\r\n  }, [messageid]);\r\n\r\n  useEffect(() => {\r\n    if (messagesRef.current) {\r\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n\r\n  const addMessage = (message) => {\r\n    const newMessages = { ...messages };\r\n\r\n    newMessages[`message-${Date.now()}`] = message;\r\n\r\n    database.ref(`messages${messageid}`).update({ messages: newMessages });\r\n  };\r\n\r\n  const isUser = (messagePseudo) => messagePseudo === pseudo;\r\n\r\n\r\n  const messageList = Object.keys(messages).map((key) => (\r\n    // console.log(messages[key].pseudo =pseudo)\r\n    <CSSTransition timeout={200} classNames='fade' key={key}>\r\n      <Message\r\n        isUser={isUser}\r\n        message={messages[key].message}\r\n        pseudo={messages[key].pseudo}\r\n      />\r\n    </CSSTransition>\r\n    \r\n  ));\r\n\r\n\r\n  return (\r\n    <div className='box'>\r\n      <div>\r\n        <div className='messages' ref={messagesRef}>\r\n          <TransitionGroup className='message'>{messageList}</TransitionGroup>\r\n        </div>\r\n      </div>\r\n      <Formulaire length={140} pseudo={pseudo} addMessage={addMessage} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}