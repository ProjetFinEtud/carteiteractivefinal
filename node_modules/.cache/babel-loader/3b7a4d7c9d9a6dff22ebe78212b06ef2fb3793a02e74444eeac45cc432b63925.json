{"ast":null,"code":"import React,{useState,useEffect,useCallback}from\"react\";import Typography from\"@mui/material/Typography\";import Grid from\"@mui/material/Grid\";import\"leaflet/dist/leaflet.css\";import InputLabel from\"@mui/material/InputLabel\";import{MapContainer,TileLayer,Marker,Popup}from\"react-leaflet\";import{Icon}from\"leaflet\";import{useMapEvents}from\"react-leaflet\";import{Form,Button}from\"react-bootstrap\";import{FullscreenControl}from\"react-leaflet-fullscreen\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChangeLocalisation(){const[markerPosition,setMarkerPosition]=useState(null);const[locationInfo,setLocationInfo]=useState(\"\");const[errors,setErrors]=useState(\"\");const[success,setSuccess]=useState(\"\");const reverseGeoCoding=useCallback(async(lat,lng)=>{const GEOCODE_URL=\"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/reverseGeocode?f=pjson&langCode=EN&location=\".concat(lng,\",\").concat(lat);try{const response=await fetch(GEOCODE_URL);const data=await response.json();const{address}=data;const city=address.City;const country=address.CountryCode;setLocationInfo(\"\".concat(city,\", \").concat(country));}catch(error){console.error(\"Error during reverse geocoding:\",error);}},[]);function AddMarkerToClick(){useMapEvents({click:e=>{const{lat,lng}=e.latlng;setMarkerPosition({lat,lng});reverseGeoCoding(lat,lng);setSuccess(\"\");}});return null;}const customIcon=new Icon({iconUrl:require(\"../../../img/placeholder.png\"),iconSize:[30,30]});const handleChangeLocation=async()=>{if(!markerPosition){setErrors(\"Veuillez marquer votre localisation sur la carte.\");return;}try{const response=await fetch(\"/user/changeLocalisation\",{method:\"PUT\",headers:{\"Content-Type\":\"application/json\",accessToken:sessionStorage.getItem(\"accessToken\")},body:JSON.stringify({lat:markerPosition.lat,lng:markerPosition.lng})});if(!response.ok){console.error(\"Erreur lors de la suppression de l'étudiant:\",response.status);return;}setSuccess(\"Votre localisation à été changer avec succès\");}catch(error){console.error(\"Erreur lors de la suppression de l'étudiant:\",error.message);}setErrors(\"\");};return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Localisation\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"location-label\",children:\"Marquez votre localisation sur la carte\"}),/*#__PURE__*/_jsx(Form.Text,{className:errors?\"text-danger\":\"text-success\",style:{fontSize:\"20px\"},children:errors||success}),/*#__PURE__*/_jsx(\"div\",{style:{height:\"60vh\"},children:/*#__PURE__*/_jsxs(MapContainer,{center:[48.860197534643966,2.3469543457031254],zoom:13,style:{height:\"100%\",width:\"100%\"},children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\"}),/*#__PURE__*/_jsx(AddMarkerToClick,{}),markerPosition&&/*#__PURE__*/_jsx(Marker,{position:markerPosition,icon:customIcon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsx(\"div\",{children:locationInfo})})}),/*#__PURE__*/_jsx(FullscreenControl,{position:\"topright\"})]})}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleChangeLocation,children:\"Changer la localisation\"})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Typography","Grid","InputLabel","MapContainer","TileLayer","Marker","Popup","Icon","useMapEvents","Form","Button","FullscreenControl","jsx","_jsx","jsxs","_jsxs","ChangeLocalisation","markerPosition","setMarkerPosition","locationInfo","setLocationInfo","errors","setErrors","success","setSuccess","reverseGeoCoding","lat","lng","GEOCODE_URL","concat","response","fetch","data","json","address","city","City","country","CountryCode","error","console","AddMarkerToClick","click","e","latlng","customIcon","iconUrl","require","iconSize","handleChangeLocation","method","headers","accessToken","sessionStorage","getItem","body","JSON","stringify","ok","status","message","Fragment","children","variant","gutterBottom","container","spacing","item","xs","id","Text","className","style","fontSize","height","center","zoom","width","url","attribution","position","icon","onClick"],"sources":["C:/Users/abdou/Documents/S9-S10/ProjetFinDetudes/Jalon3/v2/demo - Copie/server/client/src/Components/Utilisateurs/ProfilExStudent/ChangeLocalisation.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\r\nimport Typography from \"@mui/material/Typography\";\r\nimport Grid from \"@mui/material/Grid\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport InputLabel from \"@mui/material/InputLabel\";\r\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\r\nimport { Icon } from \"leaflet\";\r\nimport { useMapEvents } from \"react-leaflet\";\r\nimport { Form, Button } from \"react-bootstrap\";\r\nimport { FullscreenControl } from \"react-leaflet-fullscreen\";\r\n\r\nexport default function ChangeLocalisation() {\r\n  const [markerPosition, setMarkerPosition] = useState(null);\r\n  const [locationInfo, setLocationInfo] = useState(\"\");\r\n  const [errors, setErrors] = useState(\"\");\r\n  const [success, setSuccess] = useState(\"\");\r\n\r\n  const reverseGeoCoding = useCallback(async (lat, lng) => {\r\n    const GEOCODE_URL = `https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/reverseGeocode?f=pjson&langCode=EN&location=${lng},${lat}`;\r\n    try {\r\n      const response = await fetch(GEOCODE_URL);\r\n      const data = await response.json();\r\n      const { address } = data;\r\n      const city = address.City;\r\n      const country = address.CountryCode;\r\n      setLocationInfo(`${city}, ${country}`);\r\n    } catch (error) {\r\n      console.error(\"Error during reverse geocoding:\", error);\r\n    }\r\n  }, []);\r\n\r\n  function AddMarkerToClick() {\r\n    useMapEvents({\r\n      click: (e) => {\r\n        const { lat, lng } = e.latlng;\r\n        setMarkerPosition({ lat, lng });\r\n        reverseGeoCoding(lat, lng);\r\n        setSuccess(\"\")\r\n      },\r\n    });\r\n    return null;\r\n  }\r\n\r\n  const customIcon = new Icon({\r\n    iconUrl: require(\"../../../img/placeholder.png\"),\r\n    iconSize: [30, 30],\r\n  });\r\n\r\n  const handleChangeLocation = async () => {\r\n    if (!markerPosition) {\r\n      setErrors(\"Veuillez marquer votre localisation sur la carte.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `/user/changeLocalisation`,\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            accessToken: sessionStorage.getItem(\"accessToken\"),\r\n          },\r\n          body: JSON.stringify({\r\n            lat: markerPosition.lat,\r\n            lng: markerPosition.lng,\r\n          }),\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        console.error(\r\n          \"Erreur lors de la suppression de l'étudiant:\",\r\n          response.status\r\n        );\r\n        return;\r\n      }\r\n  \r\n    setSuccess(\"Votre localisation à été changer avec succès\");\r\n      \r\n    } catch (error) {\r\n      console.error(\r\n        \"Erreur lors de la suppression de l'étudiant:\",\r\n        error.message\r\n      );\r\n    }\r\n    setErrors(\"\");\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Typography variant=\"h6\" gutterBottom>\r\n        Localisation\r\n      </Typography>\r\n      <Grid container spacing={3}>\r\n        <Grid item xs={12}>\r\n          <InputLabel id=\"location-label\">\r\n            Marquez votre localisation sur la carte\r\n          </InputLabel>\r\n          <Form.Text className={errors ? \"text-danger\" : \"text-success\"} style={{fontSize:\"20px\"}}>\r\n            {errors || success}\r\n          </Form.Text>\r\n          <div style={{ height: \"60vh\" }}>\r\n            <MapContainer\r\n              center={[48.860197534643966, 2.3469543457031254]}\r\n              zoom={13}\r\n              style={{ height: \"100%\", width: \"100%\" }}\r\n            >\r\n              <TileLayer\r\n                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n              />\r\n              <AddMarkerToClick />\r\n              {markerPosition && (\r\n                <Marker position={markerPosition} icon={customIcon}>\r\n                  <Popup>\r\n                    <div>{locationInfo}</div>\r\n                  </Popup>\r\n                </Marker>\r\n              )}\r\n              <FullscreenControl position=\"topright\" />\r\n            </MapContainer>\r\n          </div>\r\n          <Button variant=\"primary\" onClick={handleChangeLocation}>\r\n            Changer la localisation\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </React.Fragment>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}