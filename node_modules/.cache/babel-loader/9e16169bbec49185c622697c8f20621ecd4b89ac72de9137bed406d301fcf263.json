{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import BootstrapTable from\"react-bootstrap-table-next\";import Button from\"react-bootstrap/Button\";import Chat from\"../Messages/Chat\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const DemandeContact=()=>{const[requests,setRequests]=useState([]);const[selectedPseudo,setSelectedPseudo]=useState(null);const[selectedMessageId,setSelectedMessageId]=useState(null);useEffect(()=>{const fetchData=async()=>{try{const response=await fetch(\"/user/allRequestExsContact\",{headers:{accessToken:sessionStorage.getItem(\"accessToken\")}});if(!response.ok){console.error(\"Erreur lors de la récupération des données:\",response.status);return;}const jsonData=await response.json();const newData=jsonData.columns.map(item=>({con_id:item.con_id,con_date:item.con_date,con_etat:item.con_etat,exs_login:item.exs_login,stu_login:item.stu_login,msg_id:item.msg_id}));console.log(newData);setRequests(newData);}catch(error){console.error(\"Erreur lors de la récupération des données:\",error.message);}};fetchData();},[]);const handleOpenChat=(msg_id,pseudo)=>{setSelectedMessageId(msg_id);setSelectedPseudo(pseudo);};const handleAcceptRequest=async id=>{try{const response=await fetch(\"/user/activateRequestContact/\".concat(id),{method:\"PUT\",headers:{accessToken:sessionStorage.getItem(\"accessToken\")}});if(!response.ok){console.error(\"Erreur lors de la récupération des données:\",response.status);return;}// Mettre à jour les demandes après l'acceptation\nconst updatedRequests=requests.map(request=>request.con_id===id?{...request,con_etat:\"Accepté\"}:request);setRequests(updatedRequests);}catch(error){console.error(\"Erreur lors de la récupération des données:\",error.message);}};const handleRejectRequest=async id=>{try{const con_id=id;const response=await fetch(\"/user/refusedRequestContact\",{method:\"PUT\",headers:{accessToken:sessionStorage.getItem(\"accessToken\")},body:JSON.stringify({con_id})});if(!response.ok){console.error(\"Erreur lors de la récupération des données:\",response.status);return;}// Mettre à jour les demandes après le rejet\nconst updatedRequests=requests.map(request=>request.con_id===id?{...request,con_etat:\"Refusé\"}:request);setRequests(updatedRequests);}catch(error){console.error(\"Erreur lors de la récupération des données:\",error.message);}};const handleDeleteRequest=async id=>{try{const con_id=id;const response=await fetch(\"/user/deleteRequestContact\",{method:\"DELETE\",headers:{accessToken:sessionStorage.getItem(\"accessToken\")},body:JSON.stringify({con_id})});if(!response.ok){console.error(\"Erreur lors de la récupération des données:\",response.status);return;}// Mettre à jour les demandes après la suppression\nconst updatedRequests=requests.filter(request=>request.con_id!==id);setRequests(updatedRequests);}catch(error){console.error(\"Erreur lors de la récupération des données:\",error.message);}};const columns=[{dataField:\"con_date\",text:\"Date\"},{dataField:\"con_etat\",text:\"Etat\"},{dataField:\"exs_login\",text:\"A\"},{dataField:\"stu_login\",text:\"Expéditeur\"},{dataField:\"action\",text:\"Actions\",formatter:(cellContent,row)=>/*#__PURE__*/_jsxs(\"div\",{children:[row.con_etat===\"Demande en cours\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:()=>handleAcceptRequest(row.con_id),style:{marginRight:\"10px\"},children:\"Accepter\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:()=>handleRejectRequest(row.con_id),children:\"Refuser\"})]}),row.con_etat===\"Accepter\"&&/*#__PURE__*/_jsxs(\"div\",{style:{margin:\"2px\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleOpenChat(row.msg_id,row.exs_login),style:{marginRight:\"10px\"},children:\"Ouvrir le chat\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:()=>handleOpenChat(row.msg_id,row.exs_login),children:\"Supprimer l'utilisateur\"})]})]})}];return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-5\",children:selectedMessageId?/*#__PURE__*/_jsx(Chat,{messageid:selectedMessageId,pseudo:selectedPseudo}):/*#__PURE__*/_jsx(BootstrapTable,{keyField:\"con_id\",data:requests,columns:columns,bordered:false})});};export default DemandeContact;","map":{"version":3,"names":["React","useEffect","useState","BootstrapTable","Button","Chat","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","DemandeContact","requests","setRequests","selectedPseudo","setSelectedPseudo","selectedMessageId","setSelectedMessageId","fetchData","response","fetch","headers","accessToken","sessionStorage","getItem","ok","console","error","status","jsonData","json","newData","columns","map","item","con_id","con_date","con_etat","exs_login","stu_login","msg_id","log","message","handleOpenChat","pseudo","handleAcceptRequest","id","concat","method","updatedRequests","request","handleRejectRequest","body","JSON","stringify","handleDeleteRequest","filter","dataField","text","formatter","cellContent","row","children","variant","onClick","style","marginRight","margin","className","messageid","keyField","data","bordered"],"sources":["C:/Users/abdou/Documents/S9-S10/ProjetFinDetudes/Jalon3/v2/demo - Copie/server/client/src/Components/Contact/DemandeContact.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport BootstrapTable from \"react-bootstrap-table-next\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport Chat from \"../Messages/Chat\";\r\nconst DemandeContact = () => {\r\n  const [requests, setRequests] = useState([]);\r\n  const [selectedPseudo, setSelectedPseudo] = useState(null);\r\n  const [selectedMessageId, setSelectedMessageId] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const response = await fetch(\r\n          \"/user/allRequestExsContact\",\r\n          {\r\n            headers: {\r\n              accessToken: sessionStorage.getItem(\"accessToken\"),\r\n            },\r\n          }\r\n        );\r\n        if (!response.ok) {\r\n          console.error(\r\n            \"Erreur lors de la récupération des données:\",\r\n            response.status\r\n          );\r\n          return;\r\n        }\r\n        const jsonData = await response.json();\r\n        const newData = jsonData.columns.map((item) => ({\r\n          con_id: item.con_id,\r\n          con_date: item.con_date,\r\n          con_etat: item.con_etat,\r\n          exs_login: item.exs_login,\r\n          stu_login: item.stu_login,\r\n          msg_id: item.msg_id,\r\n        }));\r\n        console.log(newData);\r\n        setRequests(newData);\r\n      } catch (error) {\r\n        console.error(\r\n          \"Erreur lors de la récupération des données:\",\r\n          error.message\r\n        );\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleOpenChat = (msg_id, pseudo) => {\r\n    setSelectedMessageId(msg_id);\r\n    setSelectedPseudo(pseudo);\r\n  };\r\n\r\n  const handleAcceptRequest = async (id) => {\r\n    try {\r\n      const response = await fetch(\r\n        `/user/activateRequestContact/${id}`,\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            accessToken: sessionStorage.getItem(\"accessToken\"),\r\n          },\r\n        }\r\n      );\r\n      if (!response.ok) {\r\n        console.error(\r\n          \"Erreur lors de la récupération des données:\",\r\n          response.status\r\n        );\r\n        return;\r\n      }\r\n      // Mettre à jour les demandes après l'acceptation\r\n      const updatedRequests = requests.map((request) =>\r\n        request.con_id === id ? { ...request, con_etat: \"Accepté\" } : request\r\n      );\r\n      setRequests(updatedRequests);\r\n    } catch (error) {\r\n      console.error(\r\n        \"Erreur lors de la récupération des données:\",\r\n        error.message\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleRejectRequest = async (id) => {\r\n    try {\r\n      const con_id = id;\r\n      const response = await fetch(\r\n        \"/user/refusedRequestContact\",\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            accessToken: sessionStorage.getItem(\"accessToken\"),\r\n          },\r\n          body: JSON.stringify({ con_id }),\r\n        }\r\n      );\r\n      if (!response.ok) {\r\n        console.error(\r\n          \"Erreur lors de la récupération des données:\",\r\n          response.status\r\n        );\r\n        return;\r\n      }\r\n      // Mettre à jour les demandes après le rejet\r\n      const updatedRequests = requests.map((request) =>\r\n        request.con_id === id ? { ...request, con_etat: \"Refusé\" } : request\r\n      );\r\n      setRequests(updatedRequests);\r\n    } catch (error) {\r\n      console.error(\r\n        \"Erreur lors de la récupération des données:\",\r\n        error.message\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleDeleteRequest = async (id) => {\r\n    try {\r\n      const con_id = id;\r\n      const response = await fetch(\r\n        \"/user/deleteRequestContact\",\r\n        {\r\n          method: \"DELETE\",\r\n          headers: {\r\n            accessToken: sessionStorage.getItem(\"accessToken\"),\r\n          },\r\n          body: JSON.stringify({ con_id }),\r\n        }\r\n      );\r\n      if (!response.ok) {\r\n        console.error(\r\n          \"Erreur lors de la récupération des données:\",\r\n          response.status\r\n        );\r\n        return;\r\n      }\r\n      // Mettre à jour les demandes après la suppression\r\n      const updatedRequests = requests.filter(\r\n        (request) => request.con_id !== id\r\n      );\r\n      setRequests(updatedRequests);\r\n    } catch (error) {\r\n      console.error(\r\n        \"Erreur lors de la récupération des données:\",\r\n        error.message\r\n      );\r\n    }\r\n  };\r\n\r\n  const columns = [\r\n    { dataField: \"con_date\", text: \"Date\" },\r\n    { dataField: \"con_etat\", text: \"Etat\" },\r\n    { dataField: \"exs_login\", text: \"A\" },\r\n    { dataField: \"stu_login\", text: \"Expéditeur\" },\r\n    {\r\n      dataField: \"action\",\r\n      text: \"Actions\",\r\n      formatter: (cellContent, row) => (\r\n        <div>\r\n          {row.con_etat === \"Demande en cours\" && (\r\n            <>\r\n              <Button\r\n                variant=\"success\"\r\n                onClick={() => handleAcceptRequest(row.con_id)}\r\n                style={{ marginRight: \"10px\" }}\r\n              >\r\n                Accepter\r\n              </Button>\r\n              <Button\r\n                variant=\"danger\"\r\n                onClick={() => handleRejectRequest(row.con_id)}\r\n              >\r\n                Refuser\r\n              </Button>\r\n            </>\r\n          )}\r\n          {row.con_etat === \"Accepter\" && (\r\n            <div style={{margin : \"2px\"}}>\r\n              <Button\r\n                variant=\"primary\"\r\n                onClick={() => handleOpenChat(row.msg_id, row.exs_login)}\r\n                style={{ marginRight: \"10px\" }}\r\n              >\r\n                Ouvrir le chat\r\n              </Button>\r\n              <Button\r\n                variant=\"danger\"\r\n                onClick={() => handleOpenChat(row.msg_id, row.exs_login)}\r\n              >\r\n                Supprimer l'utilisateur\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"container mt-5\">\r\n      {selectedMessageId ? (\r\n        <Chat messageid={selectedMessageId} pseudo={selectedPseudo} />\r\n      ) : (\r\n        <BootstrapTable\r\n          keyField=\"con_id\"\r\n          data={requests}\r\n          columns={columns}\r\n          bordered={false}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DemandeContact;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,cAAc,KAAM,4BAA4B,CACvD,MAAO,CAAAC,MAAM,KAAM,wBAAwB,CAC3C,MAAO,CAAAC,IAAI,KAAM,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,QAAA,IAAAC,SAAA,gCAAAC,IAAA,IAAAC,KAAA,yBACpC,KAAM,CAAAC,cAAc,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGZ,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACa,cAAc,CAAEC,iBAAiB,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAC1D,KAAM,CAACe,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAEhED,SAAS,CAAC,IAAM,CACd,KAAM,CAAAkB,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAC1B,4BAA4B,CAC5B,CACEC,OAAO,CAAE,CACPC,WAAW,CAAEC,cAAc,CAACC,OAAO,CAAC,aAAa,CACnD,CACF,CACF,CAAC,CACD,GAAI,CAACL,QAAQ,CAACM,EAAE,CAAE,CAChBC,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CR,QAAQ,CAACS,MACX,CAAC,CACD,OACF,CACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAV,QAAQ,CAACW,IAAI,CAAC,CAAC,CACtC,KAAM,CAAAC,OAAO,CAAGF,QAAQ,CAACG,OAAO,CAACC,GAAG,CAAEC,IAAI,GAAM,CAC9CC,MAAM,CAAED,IAAI,CAACC,MAAM,CACnBC,QAAQ,CAAEF,IAAI,CAACE,QAAQ,CACvBC,QAAQ,CAAEH,IAAI,CAACG,QAAQ,CACvBC,SAAS,CAAEJ,IAAI,CAACI,SAAS,CACzBC,SAAS,CAAEL,IAAI,CAACK,SAAS,CACzBC,MAAM,CAAEN,IAAI,CAACM,MACf,CAAC,CAAC,CAAC,CACHd,OAAO,CAACe,GAAG,CAACV,OAAO,CAAC,CACpBlB,WAAW,CAACkB,OAAO,CAAC,CACtB,CAAE,MAAOJ,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CA,KAAK,CAACe,OACR,CAAC,CACH,CACF,CAAC,CAEDxB,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAyB,cAAc,CAAGA,CAACH,MAAM,CAAEI,MAAM,GAAK,CACzC3B,oBAAoB,CAACuB,MAAM,CAAC,CAC5BzB,iBAAiB,CAAC6B,MAAM,CAAC,CAC3B,CAAC,CAED,KAAM,CAAAC,mBAAmB,CAAG,KAAO,CAAAC,EAAE,EAAK,CACxC,GAAI,CACF,KAAM,CAAA3B,QAAQ,CAAG,KAAM,CAAAC,KAAK,iCAAA2B,MAAA,CACMD,EAAE,EAClC,CACEE,MAAM,CAAE,KAAK,CACb3B,OAAO,CAAE,CACPC,WAAW,CAAEC,cAAc,CAACC,OAAO,CAAC,aAAa,CACnD,CACF,CACF,CAAC,CACD,GAAI,CAACL,QAAQ,CAACM,EAAE,CAAE,CAChBC,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CR,QAAQ,CAACS,MACX,CAAC,CACD,OACF,CACA;AACA,KAAM,CAAAqB,eAAe,CAAGrC,QAAQ,CAACqB,GAAG,CAAEiB,OAAO,EAC3CA,OAAO,CAACf,MAAM,GAAKW,EAAE,CAAG,CAAE,GAAGI,OAAO,CAAEb,QAAQ,CAAE,SAAU,CAAC,CAAGa,OAChE,CAAC,CACDrC,WAAW,CAACoC,eAAe,CAAC,CAC9B,CAAE,MAAOtB,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CA,KAAK,CAACe,OACR,CAAC,CACH,CACF,CAAC,CAED,KAAM,CAAAS,mBAAmB,CAAG,KAAO,CAAAL,EAAE,EAAK,CACxC,GAAI,CACF,KAAM,CAAAX,MAAM,CAAGW,EAAE,CACjB,KAAM,CAAA3B,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAC1B,6BAA6B,CAC7B,CACE4B,MAAM,CAAE,KAAK,CACb3B,OAAO,CAAE,CACPC,WAAW,CAAEC,cAAc,CAACC,OAAO,CAAC,aAAa,CACnD,CAAC,CACD4B,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEnB,MAAO,CAAC,CACjC,CACF,CAAC,CACD,GAAI,CAAChB,QAAQ,CAACM,EAAE,CAAE,CAChBC,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CR,QAAQ,CAACS,MACX,CAAC,CACD,OACF,CACA;AACA,KAAM,CAAAqB,eAAe,CAAGrC,QAAQ,CAACqB,GAAG,CAAEiB,OAAO,EAC3CA,OAAO,CAACf,MAAM,GAAKW,EAAE,CAAG,CAAE,GAAGI,OAAO,CAAEb,QAAQ,CAAE,QAAS,CAAC,CAAGa,OAC/D,CAAC,CACDrC,WAAW,CAACoC,eAAe,CAAC,CAC9B,CAAE,MAAOtB,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CA,KAAK,CAACe,OACR,CAAC,CACH,CACF,CAAC,CAED,KAAM,CAAAa,mBAAmB,CAAG,KAAO,CAAAT,EAAE,EAAK,CACxC,GAAI,CACF,KAAM,CAAAX,MAAM,CAAGW,EAAE,CACjB,KAAM,CAAA3B,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAC1B,4BAA4B,CAC5B,CACE4B,MAAM,CAAE,QAAQ,CAChB3B,OAAO,CAAE,CACPC,WAAW,CAAEC,cAAc,CAACC,OAAO,CAAC,aAAa,CACnD,CAAC,CACD4B,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEnB,MAAO,CAAC,CACjC,CACF,CAAC,CACD,GAAI,CAAChB,QAAQ,CAACM,EAAE,CAAE,CAChBC,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CR,QAAQ,CAACS,MACX,CAAC,CACD,OACF,CACA;AACA,KAAM,CAAAqB,eAAe,CAAGrC,QAAQ,CAAC4C,MAAM,CACpCN,OAAO,EAAKA,OAAO,CAACf,MAAM,GAAKW,EAClC,CAAC,CACDjC,WAAW,CAACoC,eAAe,CAAC,CAC9B,CAAE,MAAOtB,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CACX,6CAA6C,CAC7CA,KAAK,CAACe,OACR,CAAC,CACH,CACF,CAAC,CAED,KAAM,CAAAV,OAAO,CAAG,CACd,CAAEyB,SAAS,CAAE,UAAU,CAAEC,IAAI,CAAE,MAAO,CAAC,CACvC,CAAED,SAAS,CAAE,UAAU,CAAEC,IAAI,CAAE,MAAO,CAAC,CACvC,CAAED,SAAS,CAAE,WAAW,CAAEC,IAAI,CAAE,GAAI,CAAC,CACrC,CAAED,SAAS,CAAE,WAAW,CAAEC,IAAI,CAAE,YAAa,CAAC,CAC9C,CACED,SAAS,CAAE,QAAQ,CACnBC,IAAI,CAAE,SAAS,CACfC,SAAS,CAAEA,CAACC,WAAW,CAAEC,GAAG,gBAC1BnD,KAAA,QAAAoD,QAAA,EACGD,GAAG,CAACxB,QAAQ,GAAK,kBAAkB,eAClC3B,KAAA,CAAAF,SAAA,EAAAsD,QAAA,eACExD,IAAA,CAACH,MAAM,EACL4D,OAAO,CAAC,SAAS,CACjBC,OAAO,CAAEA,CAAA,GAAMnB,mBAAmB,CAACgB,GAAG,CAAC1B,MAAM,CAAE,CAC/C8B,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAO,CAAE,CAAAJ,QAAA,CAChC,UAED,CAAQ,CAAC,cACTxD,IAAA,CAACH,MAAM,EACL4D,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAEA,CAAA,GAAMb,mBAAmB,CAACU,GAAG,CAAC1B,MAAM,CAAE,CAAA2B,QAAA,CAChD,SAED,CAAQ,CAAC,EACT,CACH,CACAD,GAAG,CAACxB,QAAQ,GAAK,UAAU,eAC1B3B,KAAA,QAAKuD,KAAK,CAAE,CAACE,MAAM,CAAG,KAAK,CAAE,CAAAL,QAAA,eAC3BxD,IAAA,CAACH,MAAM,EACL4D,OAAO,CAAC,SAAS,CACjBC,OAAO,CAAEA,CAAA,GAAMrB,cAAc,CAACkB,GAAG,CAACrB,MAAM,CAAEqB,GAAG,CAACvB,SAAS,CAAE,CACzD2B,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAO,CAAE,CAAAJ,QAAA,CAChC,gBAED,CAAQ,CAAC,cACTxD,IAAA,CAACH,MAAM,EACL4D,OAAO,CAAC,QAAQ,CAChBC,OAAO,CAAEA,CAAA,GAAMrB,cAAc,CAACkB,GAAG,CAACrB,MAAM,CAAEqB,GAAG,CAACvB,SAAS,CAAE,CAAAwB,QAAA,CAC1D,yBAED,CAAQ,CAAC,EACN,CACN,EACE,CAET,CAAC,CACF,CAED,mBACExD,IAAA,QAAK8D,SAAS,CAAC,gBAAgB,CAAAN,QAAA,CAC5B9C,iBAAiB,cAChBV,IAAA,CAACF,IAAI,EAACiE,SAAS,CAAErD,iBAAkB,CAAC4B,MAAM,CAAE9B,cAAe,CAAE,CAAC,cAE9DR,IAAA,CAACJ,cAAc,EACboE,QAAQ,CAAC,QAAQ,CACjBC,IAAI,CAAE3D,QAAS,CACfoB,OAAO,CAAEA,OAAQ,CACjBwC,QAAQ,CAAE,KAAM,CACjB,CACF,CACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAA7D,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}